<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <title>Regression | What is H2O?</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.0.3">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    
    <link rel="next" href="../hands-on_training/classification.html" />
    
    
    <link rel="prev" href="../hands-on_training/random_forests.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../gitbook/style.css">

    
    <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-exercises/exercises.css">
    


        
    <div class="book"  data-level="3.3.4" data-basepath=".." data-revision="1416331040631">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="h2o_world_training_sandbox/README.html">
            
                
                    <a href="../h2o_world_training_sandbox/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         H2O World Training Sandbox
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="h2o_in_big_data_environments/README.html">
            
                
                    <a href="../h2o_in_big_data_environments/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         H2O in Big Data Environments
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="hands-on_training/README.html">
            
                
                    <a href="../hands-on_training/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         Hands-On Training
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.1" data-path="hands-on_training/h2o_with_the_web_ui.html">
            
                
                    <a href="../hands-on_training/h2o_with_the_web_ui.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.1.</b>
                        
                         H2O with the Web UI
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.2" data-path="hands-on_training/r_with_h2o.html">
            
                
                    <a href="../hands-on_training/r_with_h2o.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.2.</b>
                        
                         R with H2O 
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.3" data-path="hands-on_training/supervised_learning_with_regressions.html">
            
                
                    <a href="../hands-on_training/supervised_learning_with_regressions.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.</b>
                        
                         Supervised Learning
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.3.1" data-path="hands-on_training/generalized_linear_models.html">
            
                
                    <a href="../hands-on_training/generalized_linear_models.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.1.</b>
                        
                         Generalized Linear Models
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.3.2" data-path="hands-on_training/gradient_boosted_machines.html">
            
                
                    <a href="../hands-on_training/gradient_boosted_machines.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.2.</b>
                        
                         Gradient Boosted Models
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.3.3" data-path="hands-on_training/random_forests.html">
            
                
                    <a href="../hands-on_training/random_forests.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.3.</b>
                        
                         Random Forests
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="3.3.4" data-path="hands-on_training/regression.html">
            
                
                    <a href="../hands-on_training/regression.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.4.</b>
                        
                         Regression
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.3.5" data-path="hands-on_training/classification.html">
            
                
                    <a href="../hands-on_training/classification.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.5.</b>
                        
                         Classification
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.3.6" data-path="hands-on_training/deep_learning.html">
            
                
                    <a href="../hands-on_training/deep_learning.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.3.6.</b>
                        
                         Deep Learning
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3.4" data-path="hands-on_training/unsupervised_learning.html">
            
                
                    <a href="../hands-on_training/unsupervised_learning.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.</b>
                        
                         Unsupervised Learning
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.4.1" data-path="hands-on_training/kmeans_clustering.html">
            
                
                    <a href="../hands-on_training/kmeans_clustering.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.1.</b>
                        
                         KMeans Clustering
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.4.2" data-path="hands-on_training/dimensionality_reduction.html">
            
                
                    <a href="../hands-on_training/dimensionality_reduction.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.2.</b>
                        
                         Dimensionality Reduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.4.3" data-path="hands-on_training/anomaly_detection.html">
            
                
                    <a href="../hands-on_training/anomaly_detection.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.4.3.</b>
                        
                         Anomaly Detection
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3.5" data-path="hands-on_training/advanced_topics.html">
            
                
                    <a href="../hands-on_training/advanced_topics.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.</b>
                        
                         Advanced Topics
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="3.5.1" data-path="hands-on_training/multi-model_parameter_tuning_for_higgs_dataset.html">
            
                
                    <a href="../hands-on_training/multi-model_parameter_tuning_for_higgs_dataset.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.1.</b>
                        
                         Multi-model Parameter Tuning
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.5.2" data-path="hands-on_training/categorical_feature_engineering.html">
            
                
                    <a href="../hands-on_training/categorical_feature_engineering.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.2.</b>
                        
                         Categorical Feature Engineering
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3.5.3" data-path="hands-on_training/tools.html">
            
                
                    <a href="../hands-on_training/tools.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.5.3.</b>
                        
                         Other Useful Tools
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="3.6" data-path="hands-on_training/practical_use_cases.html">
            
                
                    <a href="../hands-on_training/practical_use_cases.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.6.</b>
                        
                         Practical Use Cases for Marketing
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="4" data-path="demos/README.html">
            
                
                    <a href="../demos/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                         Demos
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="4.1" data-path="demos/integration_with_tableau_and_excel.html">
            
                
                    <a href="../demos/integration_with_tableau_and_excel.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                         Tableau
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.2" data-path="demos/excel.html">
            
                
                    <a href="../demos/excel.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.2.</b>
                        
                         Excel
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4.3" data-path="demos/streaming_data.html">
            
                
                    <a href="../demos/streaming_data.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.3.</b>
                        
                         Streaming Data
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="5" data-path="hackers_station/README.html">
            
                
                    <a href="../hackers_station/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                         Build Applications on Top of H2O
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="5.1" data-path="hackers_station/kmeans.html">
            
                
                    <a href="../hackers_station/kmeans.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.1.</b>
                        
                         KMeans
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="5.2" data-path="hackers_station/grep.html">
            
                
                    <a href="../hackers_station/grep.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.2.</b>
                        
                         Grep
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="5.3" data-path="hackers_station/quantiles.html">
            
                
                    <a href="../hackers_station/quantiles.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.3.</b>
                        
                         Quantiles
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="5.4" data-path="hackers_station/start_with_sparkling_water.html">
            
                
                    <a href="../hackers_station/start_with_sparkling_water.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.4.</b>
                        
                         Build with Sparkling Water
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="6" data-path="troubleshooting/README.html">
            
                
                    <a href="../troubleshooting/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                         Troubleshooting
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="7" data-path="more_information/README.html">
            
                
                    <a href="../more_information/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                         More Information
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >What is H2O?</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_83">
                    
                        <h1 id="regression">Regression</h1>
<h2 id="regression-using-generalized-linear-models-gradient-boosting-machines-and-random-forests-in-h2o">Regression using Generalized Linear Models, Gradient Boosting Machines, and Random Forests in H2O</h2>
<p>This tutorial demonstrates regression modeling in H2O using generalized linear models (GLM), gradient boosting machines (GBM), and random forests. It requires an installation of the h2o R package and its dependencies.</p>
<h3 id="brief-overview-of-regression-modeling">Brief overview of regression modeling</h3>
<h4 id="generalized-linear-models-glm">Generalized Linear Models (GLM)</h4>
<h5 id="intuition-a-linear-combination-of-predictors-is-sufficient-for-determining-an-outcome">Intuition: A linear combination of predictors is sufficient for determining an outcome.</h5>
<h5 id="important-components">Important components:</h5>
<h6 id="1-exponential-family-for-error-distribution-gaussiannormal-poisson-gamma-tweedie-etc">1. Exponential family for error distribution (Gaussian/Normal, Poisson, Gamma, Tweedie, etc.)</h6>
<h6 id="2-link-function-whose-inverse-is-used-to-generate-predictions">2. Link function, whose inverse is used to generate predictions</h6>
<h6 id="3-elastic-net-mixing-parameter-between-the-l1-and-l2-penalties-on-the-coefficient-estimates">3. (Elastic Net) Mixing parameter between the L1 and L2 penalties on the coefficient estimates.</h6>
<h6 id="4-elastic-net-shrinkage-parameter-for-the-mixed-penalty-in-3">4. (Elastic Net) Shrinkage parameter for the mixed penalty in 3.</h6>
<h4 id="gradient-tree-boosting-machines-gbm">Gradient (Tree) Boosting Machines (GBM)</h4>
<h5 id="intuition-average-an-ensemble-of-weakly-predicting-small-trees-where-each-tree-adjusts-to-the-mistakes-of-the-preceding-trees">Intuition: Average an ensemble of weakly predicting (small) trees where each tree &quot;adjusts&quot; to the &quot;mistakes&quot; of the preceding trees.</h5>
<h5 id="important-components">Important components:</h5>
<h6 id="1-number-of-trees">1. Number of trees</h6>
<h6 id="2-maximum-depth-of-tree">2. Maximum depth of tree</h6>
<h6 id="3-learning-rate--shrinkage-parameter">3. Learning rate ( <em>shrinkage</em> parameter)</h6>
<h6 id="where-smaller-learning-rates-tend-to-require-larger-number-of-tree-and-vice-versa">where smaller learning rates tend to require larger number of tree and vice versa.</h6>
<h4 id="random-forests">Random Forests</h4>
<h5 id="intuition-average-an-ensemble-of-weakly-predicting-larger-trees-where-each-tree-is-de-correlated-from-all-other-trees">Intuition: Average an ensemble of weakly predicting (larger) trees where each tree is <em>de-correlated</em> from all other trees.</h5>
<h5 id="important-components">Important components:</h5>
<h6 id="1-number-of-trees">1. Number of trees</h6>
<h6 id="2-maximum-depth-of-tree">2. Maximum depth of tree</h6>
<h6 id="3-number-of-variables-randomly-sampled-as-candidates-for-splits">3. Number of variables randomly sampled as candidates for splits</h6>
<h6 id="4-sampling-rate-for-constructing-data-set-to-use-on-each-tree">4. Sampling rate for constructing data set to use on each tree</h6>
<h3 id="load-the-h2o-r-package-and-start-an-local-h2o-cluster">Load the h2o R package and start an local H2O cluster</h3>
<p>We will begin this tutorial by starting a local H2O cluster using the default heap size and as much compute as the operating system will allow.</p>
<pre><code>library(h2o)
h2oServer &lt;- h2o.init(nthreads = -1)

rmLastValues &lt;- function(pattern = &quot;Last.value.&quot;)
{
  keys &lt;- h2o.ls(h2oServer, pattern = pattern)$Key
  if (!is.null(keys))
    h2o.rm(h2oServer, keys)
  invisible(keys)
}
</code></pre><h3 id="load-and-prepare-the-training-and-testing-data-for-analysis">Load and prepare the training and testing data for analysis</h3>
<p>This tutorial uses a 0.1% sample of the Person-Level 2013 Public Use Microdata Sample (PUMS) from United States Census Bureau with 75% of that sample being designated to the training data set and 25% to the test data set. This data set is intended to be an update to the <a href="https://archive.ics.uci.edu/ml/datasets/Adult" target="_blank">UCI Adult Data Set</a>.</p>
<pre><code>datadir &lt;- &quot;/data&quot;
pumsdir &lt;- file.path(datadir, &quot;h2o-training&quot;, &quot;pums2013&quot;)
trainfile &lt;- &quot;adult_2013_train.csv.gz&quot;
testfile  &lt;- &quot;adult_2013_test.csv.gz&quot;

adult_2013_train &lt;- h2o.importFile(h2oServer,
                                   path = file.path(pumsdir, trainfile),
                                   key = &quot;adult_2013_train&quot;, sep = &quot;,&quot;)

adult_2013_test &lt;- h2o.importFile(h2oServer,
                                  path = file.path(pumsdir, testfile),
                                  key = &quot;adult_2013_test&quot;, sep = &quot;,&quot;)

dim(adult_2013_train)
dim(adult_2013_test)
</code></pre><p>For the purposes of validation, we will create a single column data set containing only the target variable <code>LOG_WAGP</code> from the test data set.</p>
<pre><code>actual_log_wagp &lt;- h2o.assign(adult_2013_test[, &quot;LOG_WAGP&quot;],
                              key = &quot;actual_log_wagp&quot;)
rmLastValues()
</code></pre><p>Also for our data set we have 8 columns that use integer codes to represent categorical levels so we will coerce them to factor after the data read.</p>
<pre><code>for (j in c(&quot;COW&quot;, &quot;SCHL&quot;, &quot;MAR&quot;, &quot;INDP&quot;, &quot;RELP&quot;, &quot;RAC1P&quot;, &quot;SEX&quot;, &quot;POBP&quot;)) {
  adult_2013_train[[j]] &lt;- as.factor(adult_2013_train[[j]])
  adult_2013_test[[j]]  &lt;- as.factor(adult_2013_test[[j]])
}
rmLastValues()
</code></pre><h3 id="fit-a-basic-generalized-linear-model">Fit a basic generalized linear model</h3>
<p>To illustrate some regression concepts, we will add a column of random categories to the training data set.</p>
<pre><code>rand &lt;- h2o.runif(adult_2013_train, seed = 123)
randgrp &lt;- h2o.cut(rand, seq(0, 1, by = 0.01))
adult_2013_train &lt;- cbind(adult_2013_train, RAND_GRP = randgrp)
adult_2013_train &lt;- h2o.assign(adult_2013_train, key = &quot;adult_2013_train&quot;)
rmLastValues()
</code></pre><p>We will start with an ordinary linear model that is trained using the <code>h2o.glm</code> function with Gaussian (Normal) error and no elastic net regularization (<code>lambda = 0</code>).</p>
<pre><code>log_wagp_glm_0 &lt;- h2o.glm(x = &quot;RAND_GRP&quot;, y = &quot;LOG_WAGP&quot;,
                          data = adult_2013_train,
                          key  = &quot;log_wagp_glm_0&quot;,
                          family = &quot;gaussian&quot;,
                          lambda = 0)
log_wagp_glm_0
</code></pre><h3 id="inspect-an-object-containing-a-single-generalized-linear-model">Inspect an object containing a single generalized linear model</h3>
<p>When a single model is trained by <code>h2o.glm</code> it produces an object of class <code>H2OGLMModel</code>.</p>
<pre><code>class(log_wagp_glm_0)
getClassDef(&quot;H2OGLMModel&quot;)
</code></pre><p>In this model object, most of the values of interest are contained in the <code>model</code> slot.</p>
<pre><code>names(log_wagp_glm_0@model)
coef(log_wagp_glm_0@model) # works through stats:::coef.default
log_wagp_glm_0@model$aic
1 - log_wagp_glm_0@model$deviance / log_wagp_glm_0@model$null.deviance
</code></pre><p>In addition the <code>h2o.mse</code> function can be used to calculate the mean squared error of prediction.</p>
<pre><code>h2o.mse(h2o.predict(log_wagp_glm_0, adult_2013_test),
        adult_2013_test[, &quot;LOG_WAGP&quot;])
rmLastValues()
</code></pre><h3 id="perform-10-fold-cross-validation-to-measure-variation-in-coefficient-estimates">Perform 10-fold cross-validation to measure variation in coefficient estimates</h3>
<p>We can perform cross-validation within an H2O GLM model by specifying an integer greater than 1 in the <code>nfolds</code> argument to the <code>h2o.glm</code> function.</p>
<pre><code>log_wagp_glm_0_cv &lt;- h2o.glm(x = &quot;RAND_GRP&quot;, y = &quot;LOG_WAGP&quot;,
                             data = adult_2013_train,
                             key  = &quot;log_wagp_glm_0_cv&quot;,
                             family = &quot;gaussian&quot;,
                             lambda = 0,
                             nfolds = 10L)
</code></pre><p>The resulting model object is also of class <code>H2OGLMModel</code>, but now the <code>xval</code> slot is populated with model fits resulting when one of the folds was dropped during training.</p>
<pre><code>class(log_wagp_glm_0_cv)
length(log_wagp_glm_0_cv@xval)
class(log_wagp_glm_0_cv@xval[[1L]])
</code></pre><p>We can create boxplots for each of the coefficients to see how variable the estimates were after each of the folds were dropped in turn.</p>
<pre><code>boxplot(t(sapply(log_wagp_glm_0_cv@xval, function(x) coef(x@model)))[,-100L],
        names = NULL)
points(1:99, coef(log_wagp_glm_0_cv@model)[-100L], pch = &quot;X&quot;, col = &quot;red&quot;)
abline(h = 0, col = &quot;blue&quot;)
</code></pre><h5 id="imagesrand_glm_coefpng"><img src="images/rand_glm_coef.png" alt=""></h5>
<h3 id="explore-categorical-predictors">Explore categorical predictors</h3>
<p>In generalized linear models, a categorical variable with k categories is expanded into k - 1 model coefficients. This expansion can occur in many different forms, with the most common being <em>dummy variable</em> encodings consisting of indicator columns for all but the first or last category, depending on the convention.</p>
<p>We will begin our modeling of the data by examining the regression of the natural logarithm of wages (<code>LOG_WAGP</code>) against three sets of predictors: relationship (<code>RELP</code>), educational attainment (<code>SCHL</code>), and combination of those two variables (<code>RELP_SCHL</code>).</p>
<pre><code>log_wagp_glm_relp &lt;- h2o.glm(x = &quot;RELP&quot;, y = &quot;LOG_WAGP&quot;,
                             data = adult_2013_train,
                             key  = &quot;log_wagp_glm_relp&quot;,
                             family = &quot;gaussian&quot;,
                             lambda = 0)

log_wagp_glm_schl &lt;- h2o.glm(x = &quot;SCHL&quot;, y = &quot;LOG_WAGP&quot;,
                             data = adult_2013_train,
                             key  = &quot;log_wagp_glm_schl&quot;,
                             family = &quot;gaussian&quot;,
                             lambda = 0)

log_wagp_glm_relp_schl &lt;- h2o.glm(x = &quot;RELP_SCHL&quot;, y = &quot;LOG_WAGP&quot;,
                                  data = adult_2013_train,
                                  key  = &quot;log_wagp_glm_relp_schl&quot;,
                                  family = &quot;gaussian&quot;,
                                  lambda = 0)
</code></pre><p>As we can see below, both the Akaike information criterion (AIC) and percent deviance explained metrics point to using a combination of <code>RELP</code> and <code>SCHL</code> in a linear model for <code>LOG_WAGP</code>.</p>
<pre><code>log_wagp_glm_relp@model$aic
log_wagp_glm_schl@model$aic
log_wagp_glm_relp_schl@model$aic
1 - log_wagp_glm_relp@model$deviance / log_wagp_glm_relp@model$null.deviance
1 - log_wagp_glm_schl@model$deviance / log_wagp_glm_schl@model$null.deviance
1 - log_wagp_glm_relp_schl@model$deviance / log_wagp_glm_relp_schl@model$null.deviance
</code></pre><h3 id="fit-an-elastic-net-regression-model-across-a-grid-of-parameter-settings">Fit an elastic net regression model across a grid of parameter settings</h3>
<p>Now that we are familiar with H2O model fitting in R, we can fit more sophisticated models involving a larger set of predictors.</p>
<pre><code>addpredset &lt;- c(&quot;COW&quot;, &quot;MAR&quot;, &quot;INDP&quot;, &quot;RAC1P&quot;, &quot;SEX&quot;, &quot;POBP&quot;, &quot;AGEP&quot;,
                &quot;WKHP&quot;, &quot;LOG_CAPGAIN&quot;, &quot;LOG_CAPLOSS&quot;)
</code></pre><p>In the context of elastic net regularization, we need to search the parameter space defined by the mixing parameter <code>alpha</code> and the shrinkage parameter <code>lambda</code>. To aide us in this search H2O can produce a grid of models for all combinations of a discrete set of parameters.</p>
<p>We will use different methods for specifying the <code>alpha</code> and <code>lambda</code> values as they are dependent upon one another. For the <code>alpha</code> parameter, we will specify five values ranging from 0 (ridge) to 1 (lasso) by increments of 0.25. For <code>lambda</code>, we will turn on an automated <code>lambda</code> search by setting <code>lambda = TRUE</code> and specify the number of <code>lambda</code> values to 10 by setting <code>nlambda = 10</code>.</p>
<pre><code>log_wagp_glm_grid &lt;- h2o.glm(x = c(&quot;RELP_SCHL&quot;, addpredset), y = &quot;LOG_WAGP&quot;,
                             data = adult_2013_train,
                             key  = &quot;log_wagp_glm_grid&quot;,
                             family = &quot;gaussian&quot;,
                             lambda_search = TRUE,
                             nlambda = 10,
                             return_all_lambda = TRUE,
                             alpha = c(0, 0.25, 0.5, 0.75, 1))
</code></pre><p>We now have an object of class <code>H2OGLMGrid</code> that contains a list of <code>H2OGLMModelList</code> objects for each of the models fit on the grid.</p>
<pre><code>class(log_wagp_glm_grid)
getClassDef(&quot;H2OGLMGrid&quot;)

class(log_wagp_glm_grid@model[[1L]])
getClassDef(&quot;H2OGLMModelList&quot;)

length(log_wagp_glm_grid@model[[1L]]@models)
class(log_wagp_glm_grid@model[[1L]]@models[[1L]])
</code></pre><p>Currently the <code>h2o</code> package does not contain any helper functions for extracting models of interest, so we have to explore the model object and choose the model we like best.</p>
<pre><code>log_wagp_glm_grid@model[[1L]]@models[[1L]]@model$params$alpha # ridge
log_wagp_glm_grid@model[[2L]]@models[[1L]]@model$params$alpha
log_wagp_glm_grid@model[[3L]]@models[[1L]]@model$params$alpha
log_wagp_glm_grid@model[[4L]]@models[[1L]]@model$params$alpha
log_wagp_glm_grid@model[[5L]]@models[[1L]]@model$params$alpha  # lasso

log_wagp_glm_grid_mse &lt;-
  sapply(log_wagp_glm_grid@model,
         function(x)
           sapply(x@models, function(y)
                  h2o.mse(h2o.predict(y, adult_2013_test),
                          actual_log_wagp)))
log_wagp_glm_grid_mse
log_wagp_glm_grid_mse == min(log_wagp_glm_grid_mse)

log_wagp_glm_best &lt;- log_wagp_glm_grid@model[[5L]]@models[[10L]]
</code></pre><h3 id="fit-a-gaussian-regression-with-a-log-link-function">Fit a gaussian regression with a log link function</h3>
<p>In the previous example we modeled <code>WAGP</code> on a natural logarithm scale, which implied a multiplicative error structure. We can explore if we have an additive error, but supplying the untransformed wage variable (<code>WAGP</code>) as the response and using the natural logarithm link function.</p>
<pre><code>wagp_glm_grid &lt;- h2o.glm(x = c(&quot;RELP_SCHL&quot;, addpredset), y = &quot;WAGP&quot;,
                         data = adult_2013_train,
                         key  = &quot;log_wagp_glm_grid&quot;,
                         family = &quot;gaussian&quot;,
                         link   = &quot;log&quot;,
                         lambda_search = TRUE,
                         nlambda = 10,
                         return_all_lambda = TRUE,
                         alpha = c(0, 0.25, 0.5, 0.75, 1))
wagp_glm_grid
</code></pre><h3 id="fit-a-gradient-boosting-machine-regression-model">Fit a gradient boosting machine regression model</h3>
<p>Given that not all relationships can be reduced to a linear combination or terms, we can compare the GLM results with that of a gradient (tree) boosting machine. As with the final GLM exploration, we will fit a grid of GBM models by varying the number of trees and the shrinkage rate and select the best model with respect to the test data set.</p>
<pre><code>log_wagp_gbm_grid &lt;- h2o.gbm(x = c(&quot;RELP&quot;, &quot;SCHL&quot;, addpredset),
                             y = &quot;LOG_WAGP&quot;,
                             data = adult_2013_train,
                             key  = &quot;log_wagp_gbm_grid&quot;,
                             distribution = &quot;gaussian&quot;,
                             n.trees = c(10, 20, 40),
                             shrinkage = c(0.05, 0.1, 0.2),
                             validation = adult_2013_test,
                             importance = TRUE)
log_wagp_gbm_grid

class(log_wagp_gbm_grid)
getClassDef(&quot;H2OGBMGrid&quot;)
class(log_wagp_gbm_grid@model)
length(log_wagp_gbm_grid@model)
class(log_wagp_gbm_grid@model[[1L]])
log_wagp_gbm_best &lt;- log_wagp_gbm_grid@model[[1L]]
log_wagp_gbm_best
</code></pre><p>A comparison of mean squared errors against the test set suggests our GBM fit outperforms our GLM fit.</p>
<pre><code>h2o.mse(h2o.predict(log_wagp_glm_best, adult_2013_test),
        actual_log_wagp)
h2o.mse(h2o.predict(log_wagp_gbm_best, adult_2013_test),
        actual_log_wagp)
</code></pre><h3 id="fit-a-random-forest-regression-model">Fit a random forest regression model</h3>
<p>Lastly we will fit a single random forest model with 200 trees of maximum depth 10 and compare the mean squared errors across the three model types.</p>
<pre><code>log_wagp_forest &lt;- h2o.randomForest(x = c(&quot;RELP&quot;, &quot;SCHL&quot;, addpredset),
                                    y = &quot;LOG_WAGP&quot;,
                                    data = adult_2013_train,
                                    key  = &quot;log_wagp_forest&quot;,
                                    classification = FALSE,
                                    depth = 10,
                                    ntree = 200,
                                    validation = adult_2013_test,
                                    seed = 8675309,
                                    type = &quot;BigData&quot;)
log_wagp_forest

h2o.mse(h2o.predict(log_wagp_glm_best, adult_2013_test),
        actual_log_wagp)
h2o.mse(h2o.predict(log_wagp_gbm_best, adult_2013_test),
        actual_log_wagp)
h2o.mse(h2o.predict(log_wagp_forest,   adult_2013_test),
        actual_log_wagp)
</code></pre><h3 id="fit-a-deep-learning-regression-model">Fit a deep learning regression model</h3>
<p>Lastly we will fit a single Deep Learning model with default settings (more details about Deep Learning follow later) and compare the mean squared errors across the four model types.</p>
<pre><code>log_wagp_dl &lt;- h2o.deeplearning(x = c(&quot;RELP&quot;, &quot;SCHL&quot;, addpredset),
                                y = &quot;LOG_WAGP&quot;,
                                data = adult_2013_train,
                                key  = &quot;log_wagp_dl&quot;,
                                classification = FALSE,
                                validation = adult_2013_test)
log_wagp_dl

h2o.mse(h2o.predict(log_wagp_glm_best, adult_2013_test),
        actual_log_wagp)
h2o.mse(h2o.predict(log_wagp_gbm_best, adult_2013_test),
        actual_log_wagp)
h2o.mse(h2o.predict(log_wagp_forest,   adult_2013_test),
        actual_log_wagp)
h2o.mse(h2o.predict(log_wagp_dl,       adult_2013_test),
        actual_log_wagp)
</code></pre>
                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../hands-on_training/random_forests.html" class="navigation navigation-prev " aria-label="Previous page: Random Forests"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../hands-on_training/classification.html" class="navigation navigation-next " aria-label="Next page: Classification"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-exercises/ace/ace.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-exercises/ace/theme-tomorrow.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-exercises/ace/mode-javascript.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-exercises/exercises.js"></script>
    

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        <script src="../gitbook/plugins/gitbook-plugin-exercises/jsrepl/jsrepl.js" id="jsrepl-script"></script>
    </body>
    
</html>
